<app-page-container>
  <div class="purchase-page">
    <app-back-button [link]="'/catalog/' + product()?.id" text="← Вернуться к товару"></app-back-button>

    @if (product()) {
    <div class="purchase-page__card">
      <h1 class="purchase-page__title">{{ product()?.name }}</h1>

      <form [formGroup]="purchaseForm" (ngSubmit)="onSubmit()" class="purchase-page__form">
        @for (field of purchaseFields(); track field.name) { @switch (field.type) { @case ('string') {
        <app-form-field
          [control]="field.control"
          [label]="field.title"
          [required]="true"
          [type]="field.type"
          [hasError]="!field.control.valid && field.control.touched"
          [errorMessage]="field.control | localizeFieldError"
          [placeholder]="field.title"
          [fieldId]="field.name"
        ></app-form-field>
        } @case ('number') {
        <app-form-field
          [control]="field.control"
          [label]="field.title"
          [required]="true"
          [type]="field.type"
          [hasError]="!field.control.valid && field.control.touched"
          [errorMessage]="field.control | localizeFieldError"
          [placeholder]="field.title"
          [fieldId]="field.name"
        ></app-form-field>
        } @case ('boolean') {
        <app-radio-group
          [control]="field.control"
          [label]="field.title"
          [hasError]="!field.control.valid && field.control.touched"
          [required]="true"
          [options]="[
            { value: 'true', label: 'Да' },
            { value: 'false', label: 'Нет' }
          ]"
          [name]="field.name"
        ></app-radio-group>
        } @case ('date') {
        <app-date-picker
          [hasError]="!field.control.valid && field.control.touched"
          [control]="field.control"
          [label]="field.title"
          [required]="true"
          [placeholder]="field.title"
          [fieldId]="field.name"
        ></app-date-picker>
        } @default {
        <app-form-field
          [hasError]="!field.control.valid && field.control.touched"
          [control]="field.control"
          [label]="field.title"
          [required]="true"
          [type]="field.type"
          [placeholder]="field.title"
          [fieldId]="field.name"
        ></app-form-field>
        } } }

        <div class="purchase-page__total">
          <span class="purchase-page__total-label">Итого</span>
          <span class="purchase-page__total-amount">{{ product()?.price }} ₽</span>
        </div>

        <button type="submit" class="purchase-page__submit">Оформить покупку</button>

        <p class="purchase-page__terms">Оформляя покупку, вы соглашаетесь с нашими условиями и правилами</p>
      </form>
    </div>
    } @else {
    <div class="purchase-page__loading">
      <p>Загрузка...</p>
    </div>
    }
  </div>
</app-page-container>
